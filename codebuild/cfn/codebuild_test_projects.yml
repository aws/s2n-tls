AWSTemplateFormatVersion: '2010-09-09'
Outputs:
  CodeBuildProjects2nAsanOpenSSL102Gcc6:
    Value: !Ref 's2nAsanOpenSSL102Gcc6'
  CodeBuildProjects2nIntegrationLibreSSLGcc9:
    Value: !Ref 's2nIntegrationLibreSSLGcc9'
  CodeBuildProjects2nIntegrationOpenSSL102Gcc6:
    Value: !Ref 's2nIntegrationOpenSSL102Gcc6'
  CodeBuildProjects2nIntegrationOpenSSL102Gcc6FIPS:
    Value: !Ref 's2nIntegrationOpenSSL102Gcc6FIPS'
  CodeBuildProjects2nIntegrationOpenSSL111Gcc6:
    Value: !Ref 's2nIntegrationOpenSSL111Gcc6'
  CodeBuildProjects2nIntegrationOpenSSL111Gcc6Corked:
    Value: !Ref 's2nIntegrationOpenSSL111Gcc6Corked'
  CodeBuildProjects2nIntegrationOpenSSL111Gcc6SoftCrypto:
    Value: !Ref 's2nIntegrationOpenSSL111Gcc6SoftCrypto'
  CodeBuildProjects2nIntegrationOpenSSL111Gcc9:
    Value: !Ref 's2nIntegrationOpenSSL111Gcc9'
  CodeBuildProjects2nUnitOpenSSL111Gcc6:
    Value: !Ref 's2nUnitOpenSSL111Gcc6'
  CodeBuildProjects2nValgrindOpenSSL102Gcc6:
    Value: !Ref 's2nValgrindOpenSSL102Gcc6'
  CodeBuildProjects2nValgrindOpenSSL111Gcc9:
    Value: !Ref 's2nValgrindOpenSSL111Gcc9'
  CodeBuildProjects2nfuzzerOpenSSL102FIPS:
    Value: !Ref 's2nfuzzerOpenSSL102FIPS'
  CodeBuildProjects2nfuzzerOpenSSL111Coverage:
    Value: !Ref 's2nfuzzerOpenSSL111Coverage'
  s2nAsanOpenSSL102Gcc6Role:
    Value: !Ref 's2nAsanOpenSSL102Gcc6Role'
  s2nIntegrationLibreSSLGcc9Role:
    Value: !Ref 's2nIntegrationLibreSSLGcc9Role'
  s2nIntegrationOpenSSL102Gcc6FIPSRole:
    Value: !Ref 's2nIntegrationOpenSSL102Gcc6FIPSRole'
  s2nIntegrationOpenSSL102Gcc6Role:
    Value: !Ref 's2nIntegrationOpenSSL102Gcc6Role'
  s2nIntegrationOpenSSL111Gcc6CorkedRole:
    Value: !Ref 's2nIntegrationOpenSSL111Gcc6CorkedRole'
  s2nIntegrationOpenSSL111Gcc6Role:
    Value: !Ref 's2nIntegrationOpenSSL111Gcc6Role'
  s2nIntegrationOpenSSL111Gcc6SoftCryptoRole:
    Value: !Ref 's2nIntegrationOpenSSL111Gcc6SoftCryptoRole'
  s2nIntegrationOpenSSL111Gcc9Role:
    Value: !Ref 's2nIntegrationOpenSSL111Gcc9Role'
  s2nUnitOpenSSL111Gcc6Role:
    Value: !Ref 's2nUnitOpenSSL111Gcc6Role'
  s2nValgrindOpenSSL102Gcc6Role:
    Value: !Ref 's2nValgrindOpenSSL102Gcc6Role'
  s2nValgrindOpenSSL111Gcc9Role:
    Value: !Ref 's2nValgrindOpenSSL111Gcc9Role'
  s2nfuzzerOpenSSL102FIPSRole:
    Value: !Ref 's2nfuzzerOpenSSL102FIPSRole'
  s2nfuzzerOpenSSL111CoverageRole:
    Value: !Ref 's2nfuzzerOpenSSL111CoverageRole'
Resources:
  s2nAsanOpenSSL102Gcc6:
    DependsOn: s2nAsanOpenSSL102Gcc6Role
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: 'true'
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.0.2
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: asan
          - Name: GCC_VERSION
            Value: '6'
        Image: aws/codebuild/standard:2.0
        PrivilegedMode: 'true'
        Type: LINUX_CONTAINER
      Name: s2nAsanOpenSSL102Gcc6
      ServiceRole: !Ref 's2nAsanOpenSSL102Gcc6Role'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/awslabs/s2n.git
        ReportBuildStatus: 'true'
        Type: GITHUB
      SourceVersion: ''
    Type: AWS::CodeBuild::Project
  s2nAsanOpenSSL102Gcc6Role:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Path: /
    Type: AWS::IAM::Role
  s2nIntegrationLibreSSLGcc9:
    DependsOn: s2nIntegrationLibreSSLGcc9Role
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: 'true'
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: libressl
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: integration
          - Name: GCC_VERSION
            Value: '9'
        Image: aws/codebuild/standard:2.0
        PrivilegedMode: 'true'
        Type: LINUX_CONTAINER
      Name: s2nIntegrationLibreSSLGcc9
      ServiceRole: !Ref 's2nIntegrationLibreSSLGcc9Role'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/awslabs/s2n.git
        ReportBuildStatus: 'true'
        Type: GITHUB
      SourceVersion: ''
    Type: AWS::CodeBuild::Project
  s2nIntegrationLibreSSLGcc9Role:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Path: /
    Type: AWS::IAM::Role
  s2nIntegrationOpenSSL102Gcc6:
    DependsOn: s2nIntegrationOpenSSL102Gcc6Role
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: 'true'
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.0.2
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: integration
          - Name: GCC_VERSION
            Value: '6'
        Image: aws/codebuild/standard:2.0
        PrivilegedMode: 'true'
        Type: LINUX_CONTAINER
      Name: s2nIntegrationOpenSSL102Gcc6
      ServiceRole: !Ref 's2nIntegrationOpenSSL102Gcc6Role'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/awslabs/s2n.git
        ReportBuildStatus: 'true'
        Type: GITHUB
      SourceVersion: ''
    Type: AWS::CodeBuild::Project
  s2nIntegrationOpenSSL102Gcc6FIPS:
    DependsOn: s2nIntegrationOpenSSL102Gcc6FIPSRole
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: 'true'
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.0.2-fips
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: integration
          - Name: GCC_VERSION
            Value: '6'
        Image: aws/codebuild/standard:2.0
        PrivilegedMode: 'true'
        Type: LINUX_CONTAINER
      Name: s2nIntegrationOpenSSL102Gcc6FIPS
      ServiceRole: !Ref 's2nIntegrationOpenSSL102Gcc6FIPSRole'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/awslabs/s2n.git
        ReportBuildStatus: 'true'
        Type: GITHUB
      SourceVersion: ''
    Type: AWS::CodeBuild::Project
  s2nIntegrationOpenSSL102Gcc6FIPSRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Path: /
    Type: AWS::IAM::Role
  s2nIntegrationOpenSSL102Gcc6Role:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Path: /
    Type: AWS::IAM::Role
  s2nIntegrationOpenSSL111Gcc6:
    DependsOn: s2nIntegrationOpenSSL111Gcc6Role
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: 'true'
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.1.1
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: integration
          - Name: GCC_VERSION
            Value: '6'
          - Name: S2N_COVERAGE
            Value: 'true'
          - Name: CODECOV_IO_UPLOAD
            Value: 'true'
        Image: aws/codebuild/standard:2.0
        PrivilegedMode: 'true'
        Type: LINUX_CONTAINER
      Name: s2nIntegrationOpenSSL111Gcc6
      ServiceRole: !Ref 's2nIntegrationOpenSSL111Gcc6Role'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/awslabs/s2n.git
        ReportBuildStatus: 'true'
        Type: GITHUB
      SourceVersion: ''
    Type: AWS::CodeBuild::Project
  s2nIntegrationOpenSSL111Gcc6Corked:
    DependsOn: s2nIntegrationOpenSSL111Gcc6CorkedRole
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: 'true'
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.1.1
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: integration
          - Name: GCC_VERSION
            Value: '6'
          - Name: S2N_CORKED_IO
            Value: 'true'
        Image: aws/codebuild/standard:2.0
        PrivilegedMode: 'true'
        Type: LINUX_CONTAINER
      Name: s2nIntegrationOpenSSL111Gcc6Corked
      ServiceRole: !Ref 's2nIntegrationOpenSSL111Gcc6CorkedRole'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/awslabs/s2n.git
        ReportBuildStatus: 'true'
        Type: GITHUB
      SourceVersion: ''
    Type: AWS::CodeBuild::Project
  s2nIntegrationOpenSSL111Gcc6CorkedRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Path: /
    Type: AWS::IAM::Role
  s2nIntegrationOpenSSL111Gcc6Role:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Path: /
    Type: AWS::IAM::Role
  s2nIntegrationOpenSSL111Gcc6SoftCrypto:
    DependsOn: s2nIntegrationOpenSSL111Gcc6SoftCryptoRole
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: 'true'
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.1.1
          - Name: OPENSSL_ia32cap
            Value: '"~0x200000200000000"'
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: integration
          - Name: GCC_VERSION
            Value: '6'
        Image: aws/codebuild/standard:2.0
        PrivilegedMode: 'true'
        Type: LINUX_CONTAINER
      Name: s2nIntegrationOpenSSL111Gcc6SoftCrypto
      ServiceRole: !Ref 's2nIntegrationOpenSSL111Gcc6SoftCryptoRole'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/awslabs/s2n.git
        ReportBuildStatus: 'true'
        Type: GITHUB
      SourceVersion: ''
    Type: AWS::CodeBuild::Project
  s2nIntegrationOpenSSL111Gcc6SoftCryptoRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Path: /
    Type: AWS::IAM::Role
  s2nIntegrationOpenSSL111Gcc9:
    DependsOn: s2nIntegrationOpenSSL111Gcc9Role
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: 'true'
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.1.1
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: integration
          - Name: GCC_VERSION
            Value: '9'
        Image: aws/codebuild/standard:2.0
        PrivilegedMode: 'true'
        Type: LINUX_CONTAINER
      Name: s2nIntegrationOpenSSL111Gcc9
      ServiceRole: !Ref 's2nIntegrationOpenSSL111Gcc9Role'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/awslabs/s2n.git
        ReportBuildStatus: 'true'
        Type: GITHUB
      SourceVersion: ''
    Type: AWS::CodeBuild::Project
  s2nIntegrationOpenSSL111Gcc9Role:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Path: /
    Type: AWS::IAM::Role
  s2nUnitOpenSSL111Gcc6:
    DependsOn: s2nUnitOpenSSL111Gcc6Role
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: 'true'
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.1.1
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: unit
          - Name: GCC_VERSION
            Value: '6'
          - Name: S2N_COVERAGE
            Value: 'true'
          - Name: CODECOV_IO_UPLOAD
            Value: 'true'
        Image: aws/codebuild/standard:2.0
        PrivilegedMode: 'true'
        Type: LINUX_CONTAINER
      Name: s2nUnitOpenSSL111Gcc6
      ServiceRole: !Ref 's2nUnitOpenSSL111Gcc6Role'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/awslabs/s2n.git
        ReportBuildStatus: 'true'
        Type: GITHUB
      SourceVersion: ''
    Type: AWS::CodeBuild::Project
  s2nUnitOpenSSL111Gcc6Role:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Path: /
    Type: AWS::IAM::Role
  s2nValgrindOpenSSL102Gcc6:
    DependsOn: s2nValgrindOpenSSL102Gcc6Role
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: 'true'
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.0.2
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: valgrind
          - Name: GCC_VERSION
            Value: '6'
        Image: aws/codebuild/standard:2.0
        PrivilegedMode: 'true'
        Type: LINUX_CONTAINER
      Name: s2nValgrindOpenSSL102Gcc6
      ServiceRole: !Ref 's2nValgrindOpenSSL102Gcc6Role'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/awslabs/s2n.git
        ReportBuildStatus: 'true'
        Type: GITHUB
      SourceVersion: ''
    Type: AWS::CodeBuild::Project
  s2nValgrindOpenSSL102Gcc6Role:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Path: /
    Type: AWS::IAM::Role
  s2nValgrindOpenSSL111Gcc9:
    DependsOn: s2nValgrindOpenSSL111Gcc9Role
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: 'true'
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.1.1
          - Name: BUILD_S2N
            Value: 'true'
          - Name: TESTS
            Value: valgrind
          - Name: GCC_VERSION
            Value: '9'
        Image: aws/codebuild/standard:2.0
        PrivilegedMode: 'true'
        Type: LINUX_CONTAINER
      Name: s2nValgrindOpenSSL111Gcc9
      ServiceRole: !Ref 's2nValgrindOpenSSL111Gcc9Role'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/awslabs/s2n.git
        ReportBuildStatus: 'true'
        Type: GITHUB
      SourceVersion: ''
    Type: AWS::CodeBuild::Project
  s2nValgrindOpenSSL111Gcc9Role:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Path: /
    Type: AWS::IAM::Role
  s2nfuzzerOpenSSL102FIPS:
    DependsOn: s2nfuzzerOpenSSL102FIPSRole
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: 'true'
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.0.2-fips
          - Name: LATEST_CLANG
            Value: 'true'
          - Name: TESTS
            Value: fuzz
          - Name: FUZZ_TIMEOUT_SEC
            Value: '120'
        Image: aws/codebuild/standard:2.0
        PrivilegedMode: 'true'
        Type: LINUX_CONTAINER
      Name: s2nfuzzerOpenSSL102FIPS
      ServiceRole: !Ref 's2nfuzzerOpenSSL102FIPSRole'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/awslabs/s2n.git
        ReportBuildStatus: 'true'
        Type: GITHUB
      SourceVersion: ''
    Type: AWS::CodeBuild::Project
  s2nfuzzerOpenSSL102FIPSRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Path: /
    Type: AWS::IAM::Role
  s2nfuzzerOpenSSL111Coverage:
    DependsOn: s2nfuzzerOpenSSL111CoverageRole
    Properties:
      Artifacts:
        Type: NO_ARTIFACTS
      BadgeEnabled: 'true'
      Environment:
        ComputeType: BUILD_GENERAL1_2XLARGE
        EnvironmentVariables:
          - Name: S2N_LIBCRYPTO
            Value: openssl-1.1.1
          - Name: LATEST_CLANG
            Value: 'true'
          - Name: TESTS
            Value: fuzz
          - Name: FUZZ_TIMEOUT_SEC
            Value: '120'
          - Name: S2N_COVERAGE
            Value: 'true'
        Image: aws/codebuild/standard:2.0
        PrivilegedMode: 'true'
        Type: LINUX_CONTAINER
      Name: s2nfuzzerOpenSSL111Coverage
      ServiceRole: !Ref 's2nfuzzerOpenSSL111CoverageRole'
      Source:
        BuildSpec: codebuild/spec/buildspec_ubuntu.yml
        GitCloneDepth: '1'
        Location: https://github.com/awslabs/s2n.git
        ReportBuildStatus: 'true'
        Type: GITHUB
      SourceVersion: ''
    Type: AWS::CodeBuild::Project
  s2nfuzzerOpenSSL111CoverageRole:
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action:
              - sts:AssumeRole
            Effect: Allow
            Principal:
              Service:
                - codebuild.amazonaws.com
      Path: /
    Type: AWS::IAM::Role
