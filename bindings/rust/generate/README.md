# Adding New Bindings

## Unstable APIs
If we were adding unstable api's contained in `api/unstable/foo.h` we would do the following.
1. Add the unstable feature  in `generate/src/main.rs`
```
    write_unstable_api_bindings(
        "foo",
        &out_dir,
        functions.clone(),
    );
```
2. Add the feature to `s2n-tls-sys/Cargo.toml`
```
    [features]
    default = []
    crl = []
+   foo = []
    fingerprint = []
    internal = []
    npn = []
    pq = ["cmake"] # the pq build logic is complicated so just use cmake instead
    quic = []
    renegotiate = []
```

3. Add the feature to `s2n-tls-sys/src/libs.rs`
```
conditional_module!(foo, "foo");
```

4. Allowlist any types in `generate/src/main.rs - FunctionCallbacks::tests`. The generated tests that are failing in `s2n-tls-sys` will tell you exactly what structs you need to allowlist
```
        types.extend(
            [
+               "foo_type"
                "s2n_async_pkey_fn",
                "s2n_async_pkey_op",
                ...
                "s2n_crl_lookup_callback",
                "s2n_renegotiate_request_cb"
            ]
```

5. Add the autogenerated file to `bindings/rust/.gitignore
```
s2n-tls-sys/src/foo.rs
```